{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5 py-5">
    <div class="card shadow-lg border-0 rounded-lg mx-auto analytics-card-main">
        <div class="card-header bg-gradient-analytics text-white text-center py-4 rounded-top">
            <h2 class="mb-0 display-5 font-weight-bold">
                üìä Weak Subjects Analysis
            </h2>
            <p class="lead mb-0 mt-2">Visualizing areas where you can improve.</p>
        </div>
        <div class="card-body p-5 text-center">

            {% if weak_subjects %}
                <h3 class="mb-4 fs-4 text-danger-emphasis">
                    Looks like these subjects need your attention:
                </h3>
                <div class="row justify-content-center mb-5">
                    <div class="col-md-8">
                        <ul class="list-group list-group-flush text-start shadow-sm rounded-lg animate-fade-in">
                            {% for subj, score in weak_subjects.items %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span class="fs-5 text-primary-darker">{{ subj|title }}</span>
                                    <span class="badge bg-warning text-dark fs-6 py-2 px-3 rounded-pill">Score: {{ score }}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                {% if pie_chart %}
                    <h3 class="mt-5 mb-4 fs-4 text-dark-emphasis">
                        Your Weak Subjects at a Glance:
                    </h3>
                    <div class="pie-chart-container animate-scale-in">
                        <img src="{{ pie_chart }}" alt="Weak Subjects Pie Chart" class="img-fluid rounded shadow-sm">
                    </div>
                    <small class="text-muted mt-3 d-block">This chart shows the distribution of your scores in weak subjects.</small>
                {% else %}
                    <div class="alert alert-warning mt-4" role="alert">
                        No pie chart available. Ensure the data allows for chart generation.
                    </div>
                {% endif %}

            {% else %}
                <div class="alert alert-success alert-lg mt-5" role="alert">
                    <h4 class="alert-heading">üéâ Great News!</h4>
                    <p class="mb-0 fs-5">You have no weak subjects identified. Keep up the excellent work!</p>
                </div>
            {% endif %}

            <div class="mt-5 pt-3 border-top">
                <a href="{% url 'dashboard' %}" class="btn btn-secondary btn-lg shadow-sm animate-button-back">
                    üè† Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

{# Custom CSS for professional & attractive styling #}
<style>
    body {
        background-color: #f0f8ff; /* Light, calming blue */
        font-family: 'Roboto', sans-serif; /* A common, clean font */
    }
    .analytics-card-main {
        border-radius: 15px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
        overflow: hidden;
    }
    .card-header {
        border-bottom: none;
        border-radius: 15px 15px 0 0;
    }
    .bg-gradient-analytics {
        background: linear-gradient(135deg, #007bff 0%, #28a745 100%); /* Blue to Green gradient */
    }
    .display-5 {
        font-size: 2.5rem;
        letter-spacing: 0.8px;
    }
    .lead {
        font-size: 1.15rem;
        opacity: 0.9;
    }
    .text-danger-emphasis {
        color: #dc3545 !important;
        font-weight: 600;
        font-size: 1.7rem;
    }
    .text-dark-emphasis {
        color: #343a40;
        font-weight: 600;
        font-size: 1.7rem;
    }
    .list-group-item {
        background-color: #fff3e0; /* Light orange background for list items */
        border-color: #ffcc80;
        margin-bottom: 8px; /* Space between items */
        border-radius: 8px; /* Rounded list items */
        font-weight: 500;
        padding: 12px 20px;
        transition: transform 0.2s ease-in-out;
    }
    .list-group-item:hover {
        transform: translateX(5px); /* Slight slide on hover */
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .text-primary-darker {
        color: #0056b3; /* A slightly darker primary blue */
    }
    .badge-warning { /* Override default Bootstrap warning badge if needed */
        background-color: #ffc107 !important;
        color: #212529 !important;
    }
    .pie-chart-container {
        max-width: 500px; /* Limit chart size */
        margin: 20px auto;
        padding: 15px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .pie-chart-container img {
        max-width: 100%;
        height: auto;
        display: block; /* Remove extra space below image */
    }
    .alert-lg {
        padding: 2rem;
    }
    .alert-heading {
        font-weight: 700;
    }

    /* Animations */
    .animate-fade-in {
        animation: fadeIn 0.8s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-scale-in {
        animation: scaleIn 1s ease-out;
    }
    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
    .animate-button-back {
        animation: bounceIn 1.5s ease-out;
    }
    @keyframes bounceIn {
        0%, 20%, 40%, 60%, 80%, 100% {
            transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
        }
        0% { opacity: 0; transform: scale3d(0.3, 0.3, 0.3); }
        20% { transform: scale3d(1.1, 1.1, 1.1); }
        40% { transform: scale3d(0.9, 0.9, 0.9); }
        60% { opacity: 1; transform: scale3d(1.03, 1.03, 1.03); }
        80% { transform: scale3d(0.97, 0.97, 0.97); }
        100% { opacity: 1; transform: scale3d(1, 1, 1); }
    }
    .btn-secondary { /* Re-applying styles to ensure consistency */
        background-color: #6c757d;
        border-color: #6c757d;
        font-weight: bold;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        padding: 0.8rem 2rem;
        border-radius: 8px;
        font-size: 1.25rem;
    }
    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(108, 117, 125, 0.3);
    }
    .btn-secondary:active {
        transform: translateY(0);
        box-shadow: none;
    }
</style>
{% endblock %}